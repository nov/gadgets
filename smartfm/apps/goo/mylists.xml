<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="smart.fm" 
               description="smart.fm gadget for OpenSocial containers"
               author_email="nov@matake.jp"
               thumbnail="http://matake.jp/gadgets/smartfm/images/thumbnail.png"
               screenshot="http://matake.jp/gadgets/smartfm/images/screenshot.png"
               singleton="true">
    <Require feature="opensocial-0.8" />
    <Require feature="dynamic-height" />
    <Optional feature="content-rewrite">
      <Param name="include-tags"></Param>
    </Optional>
    <Icon>http://smart.fm/favicon.ico</Icon>
  </ModulePrefs>
  <UserPref name="username" display_name="Your smart.fm username" datatype="string" required="true" />
  <UserPref name="per_page" display_name="The number of lists" datatype="enum" default_value="5" required="true">
    <EnumValue value="3" />
    <EnumValue value="5" />
    <EnumValue value="10" />
    <EnumValue value="15" />
    <EnumValue value="20" />
  </UserPref>
  <Content type="html" view="canvas, home, profile">
    <![CDATA[
      <link href="http://matake.jp/gadgets/smartfm/stylesheets/mylists.css" media="screen" rel="stylesheet" type="text/css" />
      <script type="text/javascript" src="http://matake.jp/gadgets/smartfm/javascripts/opensocial-jquery.min.js"></script>
      <script type="text/javascript" src="http://matake.jp/gadgets/smartfm/javascripts/start_swf.js"></script>
      <script type="text/javascript" src="http://matake.jp/gadgets/smartfm/javascripts/smartfm.js"></script>
      <script type="text/javascript">
        var smartfm = new Smartfm();
      </script>
    ]]>
  </Content>
  <Content type="html" view="profile, home">
    <![CDATA[
      <script type="text/javascript">
      jQuery(function($) {
        smartfm.loadLists('summary');
      });
      </script>
      <div id="content" class="profile">
        <div id="lists"></div>
    ]]>
  </Content>
  <Content type="html" view="canvas">
    <![CDATA[
      <script type="text/javascript">
      var share_this = function() {
        opensocial.requestShareApp(
          'VIEWER_FRIENDS',
          opensocial.newMessage("smart.fm gadget is here!"),
          function (status) {
            alert("callback is called");
            console.info(status)
            if (status.hadError())
              document.getElementById('message').innerHTML = status.getErrorCode();
            else
              document.getElementById('message').innerHTML = 'message sent';
          }
        )
      };
      var send_message = function() {
        var params = [];
        params[opensocial.Message.Field.TITLE] = 'hahaha';
        var msg = opensocial.newMessage("hey hey hey!", params);
        opensocial.requestSendMessage(
          'OWNER',
          msg,
          function(status) {
            alert("callback is called");
            console.info(status)
            if (status.hadError()) {
              document.getElementById('message').innerHTML = status.getErrorCode();
            } else {
              document.getElementById('message').innerHTML = 'message sent';
            }
          }
        );
      }
      jQuery(function($) {
        smartfm.loadProfile();
        smartfm.loadLists('detail');
        gadgets.window.adjustHeight();
      });
      </script>
      <div id="content" class="canvas">
        <div id="message"></div>
        <div id="menu">
          <a class="send_message" href="#" onclick="return send_message();">message</a>
          <a class="share_this" href="#" onclick="return share_this();">share</a>
          <a class="home" href="http://smart.fm/home" target="_blank">smart.fm</a>
        </div>
        <div id="user"></div>
        <div id="lists"></div>
    ]]>
  </Content>
  <Content type="html" view="canvas, home, profile">
    <![CDATA[
        <div class="powered_by">
          <a href="http://smart.fm" target="_blank">
            <img width="210" height="36" alt="powered by smart.fm API" src="http://developer.smart.fm/files/powered_by_smartfm_210x36_white.gif" />
          </a>
        </div>
      </div>
    ]]>
  </Content>
</Module>
